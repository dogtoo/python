<!DOCTYPE html>

<html lang="zh-Hant-TW">
<head>
    <meta http-equiv="content-type" content="text/html;charset=UTF8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart', 'line']});
        google.charts.setOnLoadCallback(drawChart);
    
        function drawChart() {
            var res = {'bdate':'20190301', 'edate':'20200228'};
            $.post('lastMonthUsedfunds', res, function(req) {
                var piechart = $("#piechart");
                var linechart = $("#piechart");
                var legend_ = 'true';
                var m_ = [];
                for (var m in req) {
                    m_.push(m);
                }
                m_.reverse();
                var ldata1_ = [];
                var ldata2_ = [];
                var lrowG_ = true;
                var lrowG1 = [];
                var lrowG2 = [];
                m_.forEach(function(m) {
                    var title_ = m;
                    var data_ = [['group','funds']];

                    var lrow1 = [new Date(m.substr(0,4), m.substr(4,2))];
                    var lrow2 = [new Date(m.substr(0,4), m.substr(4,2))];
                    for (var i in req[m].group) {
                        var row = [];
                        row.push(req[m].group[i].group);
                        row.push(req[m].group[i].FII_I);
                        data_.push(row);
                        
                        if (req[m].group[i].group.match(/17|24|25|26|27|28|31|03|01|05|15|14|10|02/)) {
                            if (lrowG_) lrowG1.push(req[m].group[i].group);
                            lrow1.push(Math.floor(req[m].group[i].FII_I/1000000)/100);
                        } else {
                            if (lrowG_) lrowG2.push(req[m].group[i].group);
                            lrow2.push(Math.floor(req[m].group[i].FII_I/1000000)/100);
                        }
                    }
                    ldata1_.push(lrow1);
                    ldata2_.push(lrow2);
                    lrowG_ = false;
                    
                    var data = google.visualization.arrayToDataTable(data_);
                    
                    var options = {
                        title: title_,
                        //pieSliceText: 'label',
                        //sliceVisibilityThreshold: .8,
                        legend: legend_
                    };
                    
                    p = piechart.clone().appendTo('div.pie');
                    $(p).show();
                    if (legend_ === 'true') {
                        $(p).removeClass('col-3').addClass('col-4');
                        legend_ = 'none';
                    }
                    //var chart = new google.visualization.PieChart(document.getElementById('piechart'));
                    var chart = new google.visualization.PieChart(p[0]);
                    chart.draw(data, options);
                });
                
                var data = new google.visualization.DataTable();
                data.addColumn('date', 'X');
                for (var i in lrowG1) {
                    data.addColumn('number', lrowG1[i]);
                }
                // ['202002', FII_I(01), FII_I(02) ...]
                data.addRows(ldata1_);

                var options = {
                    hAxis: {
                      title: 'year/month'
                    },
                    vAxis: {
                      title: 'Funds(億)'
                    }/*,
                    colors: ['#a52714', '#097138']*/
                };
                var line = $("#linechart1");
                var linechart = new google.charts.Line(line[0]);
                linechart.draw(data, options);
                
                data = new google.visualization.DataTable();
                data.addColumn('date', 'X');
                for (var i in lrowG2) {
                    data.addColumn('number', lrowG2[i]);
                }
                // ['202002', FII_I(01), FII_I(02) ...]
                data.addRows(ldata2_);

                var options = {
                    hAxis: {
                      title: 'year/month'
                    },
                    vAxis: {
                      title: 'Funds(億)'
                    }/*,
                    colors: ['#a52714', '#097138']*/
                };
                var line = $("#linechart2");
                var linechart = new google.charts.Line(line[0]);
                linechart.draw(data, google.charts.Line.convertOptions(options));
            });            
        }

        
    </script>
</head>
<body>
    <div id="piechart" class="col-3 col-sm-6" style="width: 400px; height: 300px; display:none"></div>
    <div class="container-fluid">
        <div class="row line">
            <div id="linechart1" class="col-6 col-sm-12" style="width: 800px; height: 400px"></div>
            <div id="linechart2" class="col-6 col-sm-12" style="width: 800px; height: 400px"></div>
        </div>
        <div class="row pie">
        </div>
    </div>
</body>
</html>

